/*
    ì„œë¸Œí€„ë¦¬
        - ì¿¼ë¦¬ ì•ˆì˜ ì¿¼ë¦¬
        - ì„œë¸Œì¿¼ë¦¬ëŠ” ë°˜ë“œì‹œ ê´„í˜¸()ë¡œ ê°ì‹¼ë‹¤.

        1. SELECT ì ˆì˜ ì»¬ëŸ¼ìœ¼ë¡œ ì‚¬ìš© -> ìŠ¤ì¹¼ë¼ ì„œë¸Œì¿¼ë¦¬
        2. FROM ì ˆì˜ í…Œì´ë¸”ë¡œ ì‚¬ìš© -> ì¸ë¼ì¸ ë·°
        3. WHERE ì ˆì˜ ê°’ìœ¼ë¡œ ì‚¬ìš© -> ì„œë¸Œì¿¼ë¦¬
        4. GROUP BY ì»¬ëŸ¼ HAVING ì ˆ
        <ê¸°ë³¸ êµ¬ì¡°>
        SELECT ì»¬ëŸ¼
        FROM í…Œì´ë¸”
        WHERE ì»¬ëŸ¼ ì—°ì‚°ìž (SELECT ì»¬ëŸ¼ FROM í…Œì´ë¸” 	WHERE ì¡°ê±´)
);

*/


CREATE TABLE department (
    dept_id INT PRIMARY KEY,
    dept_name VARCHAR(30)
);

CREATE TABLE employee (
    emp_id INT PRIMARY KEY,
    emp_name VARCHAR(30),
    salary INT,
    dept_id INT
);

INSERT INTO department VALUES
(10, 'ê°œë°œ'),
(20, 'ì¸ì‚¬'),
(30, 'ì˜ì—…');

INSERT INTO employee VALUES
(1, 'í™ê¸¸ë™', 4000, 10),
(2, 'ì´ìˆœì‹ ', 5000, 10),
(3, 'ê°•ê°ì°¬', 3500, 20),
(4, 'ìœ ê´€ìˆœ', 3000, NULL);


-- 1. í‰ê·  ê¸‰ì—¬ë³´ë‹¤ ê¸‰ì—¬ê°€ ë†’ì€ ì‚¬ì›ì„ ì¡°íšŒí•˜ì‹œì˜¤.
SELECT AVG(salary)
FROM employee; -- 3875.0000
SELECT emp_name,salary  
FROM employee;
SELECT emp_name, salary
FROM employee
WHERE salary > (
    SELECT AVG(salary) FROM employee
);
-- 2. ê°œë°œ ë˜ëŠ” ì¸ì‚¬ ë¶€ì„œì— ì†í•œ ì‚¬ì›ì„ ì¡°íšŒí•˜ì‹œì˜¤.
SELECT emp_name
FROM employee
WHERE dept_id IN (
    SELECT dept_id
    FROM department
    WHERE dept_name IN ('ê°œë°œ', 'ì¸ì‚¬')
);

-- 3. ì¸ì‚¬ ë¶€ì„œ ì‚¬ì› ì¤‘ ìµœì†Œ ê¸‰ì—¬ë³´ë‹¤ ê¸‰ì—¬ê°€ ë†’ì€ ì‚¬ì›ì„ ì¡°íšŒí•˜ì‹œì˜¤.
INSERT INTO employee VALUES 
( 5,'ê¹€ì² ìˆ˜',3700,20),
( 6,'ì•ˆì¤‘ê·¼',4600,20),
( 7,'ì´ìš©ì‹',3200,20);
-- ìµœì†Ÿê°’ êµ¬í•˜ê¸°
SELECT MIN(salary) FROM employee;
-- ì¸ì‚¬ë¶€ì„œì—ì„œ ìµœì†Œê°’ì„ êµ¬í•´ ê¸°ì¤€ê°’ë§Œ ê°€ì§€ê³  ì „ì²´ì‚¬ì›ì—ì„œ ì¶”ì¶œí•œë‚´ìš©
SELECT emp_name, salary,dept_id
FROM employee
WHERE salary > ANY (
    SELECT salary
    FROM employee
    WHERE dept_id = 20
);
-- ì¸ì‚¬ë¶€ì„œì¤‘ ìµœì†Œê¸‰ì—¬ ì´ìƒ
-- any ëŠ” from ë’¤ì— employee ì „ì²´ì™€ ë¹„êµí•˜ê²Œ ë˜ê¸° ë•Œë¬¸ì— ê²°ë¡ ì ìœ¼ë¡œ employeeì˜ ìµœì†Ÿê°’ë³´ë‹¤ í¬ë‹¤ëŠ” ì˜ë¯¸ê°€ ëœë‹¤. 
SELECT emp_name, salary,dept_id
FROM employee
WHERE dept_id = 20           -- [1] ëŒ€ìƒìžë¥¼ 'ì¸ì‚¬ë¶€'ë¡œ ë¨¼ì € í•œì •í•©ë‹ˆë‹¤.
  AND salary > ANY (         -- [2] ê·¸ ì‚¬ëžŒë“¤ ì¤‘ ë‹¤ìŒ ì¡°ê±´ì— ë§žëŠ” ì‚¬ëžŒë§Œ!
      SELECT salary 
      FROM employee 
      WHERE dept_id = 20     -- [3] ì¸ì‚¬ë¶€ ì›”ê¸‰ë“¤(ê¸°ì¤€ì¹˜)ë³´ë‹¤ í° ì‚¬ëžŒ
  );
-- ê·¸ëž˜ì„œ ì‹¤ë¬´ ê¶Œìž¥í˜•
SELECT emp_name, salary
FROM employee
WHERE dept_id = 20           -- ì¸ì‚¬ë¶€ ì¤‘ì—ì„œ
  AND salary > (             -- ì›”ê¸‰ì´ ë” í° ì‚¬ëžŒ!
      SELECT MIN(salary) 
      FROM employee 
      WHERE dept_id = 20     -- ì¸ì‚¬ë¶€ ìµœì†Œ ì›”ê¸‰ë³´ë‹¤
  );
  /*
    ANY: "ë¦¬ìŠ¤íŠ¸ ì¤‘ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê²ƒì´ ìµœì†Œí•œ í•˜ë‚˜ë¼ë„ ìžˆëŠ”ê°€?"
    ALL: "ë¦¬ìŠ¤íŠ¸ì˜ ëª¨ë“  í•­ëª©ì´ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ”ê°€?"
    ì´ëŸ° ì¡´ìž¬ë¡ ì  ë¹„êµë¥¼ í•  ë•ŒëŠ” MIN()ì´ë‚˜ MAX() ê°™ì€ ê³„ì‚° í•¨ìˆ˜ë³´ë‹¤ 
    ANY/ALL ì—°ì‚°ìžê°€ ì»´í“¨í„° ê³µí•™ì ìœ¼ë¡œ í›¨ì”¬ ë” ê·¼ë³¸ì ì´ê³  ë¹ ë¥¸ ì²˜ë¦¬ë¥¼ í•  ë•Œê°€ ìžˆìŠµë‹ˆë‹¤.
  */
select * from employee;
-- 4. ì¸ì‚¬ ë¶€ì„œ ì‚¬ì› ì¤‘ ìµœëŒ€ ê¸‰ì—¬ë³´ë‹¤ ê¸‰ì—¬ê°€ ë†’ì€ ì‚¬ì›ì„ ì¡°íšŒí•˜ì‹œì˜¤.(ë³µì‚¬ë¶™ìž„.ë‚˜ì¤‘ì— ìž¬í™•ì¸)
SELECT emp_name, salary, dept_id
FROM employee
WHERE salary > ALL (
    SELECT salary
    FROM employee
    WHERE dept_id = 20
);

SELECT dept_name, dept_id
FROM department
WHERE dept_id = 20;

SELECT emp_name, salary, dept_id
FROM employee
WHERE dept_id = 20;
/*
    EXISTS ì„œë¸Œì¿¼ë¦¬
        - ì„œë¸Œì¿¼ë¦¬ì˜ ê²°ê³¼ê°€ ì¡´ìž¬í•˜ëŠ”ì§€ ì—¬ë¶€ë¥¼ í™•ì¸
        - ì„œë¸Œì¿¼ë¦¬
*/
-- 5. ì‚¬ì›ì´ ì¡´ìž¬í•˜ëŠ” ë¶€ì„œë§Œ ì¡°íšŒí•˜ì‹œì˜¤.
 /* 10(ê°œë°œ),20(ì¸ì‚¬)
 30(ì˜ì—…)ì€ ì‚¬ì›ì´ ì—†ìŒ */
/*
    SELECT 1ì˜ ì˜ë¯¸: EXISTSëŠ” ë°ì´í„°ê°€ "ìžˆëƒ ì—†ëƒ"ë§Œ ê¶ê¸ˆí•  ë¿ìž…ë‹ˆë‹¤. 
                    êµ¬ì²´ì ì¸ ê°’(ì´ë¦„, ë‚˜ì´ ë“±)ì€ í•„ìš” ì—†ê¸° ë•Œë¬¸ì— ê´€ìŠµì ìœ¼ë¡œ ê°€ìž¥ ê°€ë²¼ìš´ ê°’ì¸ 1ì„ ì”ë‹ˆë‹¤
                    (ì‹¤ì œë¡œ SELECT *ë¥¼ ì¨ë„ ì„±ëŠ¥ ì°¨ì´ëŠ” ê±°ì˜ ì—†ì§€ë§Œ 1ì´ ë” ëª…í™•í•©ë‹ˆë‹¤.)
*/
/*
    EXISTSëŠ” ì¼ë°˜ì ì¸ ì„œë¸Œì¿¼ë¦¬ì™€ ìž‘ë™ ë°©ì‹ì´ ì¡°ê¸ˆ ë‹¤ë¦…ë‹ˆë‹¤.

        1.ë©”ì¸ ì¿¼ë¦¬ ì‹¤í–‰: department í…Œì´ë¸”ì—ì„œ ì²« ë²ˆì§¸ í–‰(ë¶€ì„œ)ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.

        2.ì„œë¸Œì¿¼ë¦¬ í™•ì¸: ê°€ì ¸ì˜¨ ë¶€ì„œì˜ dept_idë¥¼ ì„œë¸Œì¿¼ë¦¬ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.

        3.ì¡°ê±´ ê²€ì‚¬: employee í…Œì´ë¸” ì „ì²´ë¥¼ ë’¤ì ¸ì„œ, í•´ë‹¹ dept_idë¥¼ ê°€ì§„ ì§ì›ì´ ìžˆëŠ”ì§€ ì°¾ìŠµë‹ˆë‹¤.

            - ì°¾ì•˜ë‹¤ë©´? ì„œë¸Œì¿¼ë¦¬ëŠ” TRUEë¥¼ ë°˜í™˜í•˜ê³ , í•´ë‹¹ ë¶€ì„œ ì´ë¦„(dept_name)ì€ ìµœì¢… ê²°ê³¼ì— í¬í•¨ë©ë‹ˆë‹¤.

            - ì—†ë‹¤ë©´? ì„œë¸Œì¿¼ë¦¬ëŠ” FALSEë¥¼ ë°˜í™˜í•˜ê³ , í•´ë‹¹ ë¶€ì„œëŠ” ê²°ê³¼ì—ì„œ ì œì™¸ë©ë‹ˆë‹¤.

        4.ë°˜ë³µ: ëª¨ë“  ë¶€ì„œì— ëŒ€í•´ 1~3ë²ˆ ê³¼ì •ì„ ë°˜ë³µí•©ë‹ˆë‹¤.

        ì„±ëŠ¥ìƒì˜ ìž¥ì : EXISTSëŠ” ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ë°ì´í„°ë¥¼ ì°¾ëŠ” ì¦‰ì‹œ íƒìƒ‰ì„ ë©ˆì¶¥ë‹ˆë‹¤. 
        ë§Œì•½ ì–´ë–¤ ë¶€ì„œì— ì§ì›ì´ 1,000ëª… ìžˆì–´ë„, ì²« ë²ˆì§¸ ì§ì›ë§Œ ë°œê²¬í•˜ë©´ ë°”ë¡œ "ì‘, ìžˆì–´!"ë¼ê³ 
        íŒë‹¨í•˜ê³  ë‹¤ìŒ ë¶€ì„œë¡œ ë„˜ì–´ê°‘ë‹ˆë‹¤. ê·¸ëž˜ì„œ ë°ì´í„°ê°€ ë§Žì„ ë•Œ íš¨ìœ¨ì ìž…ë‹ˆë‹¤.

        -- INì„ ì‚¬ìš©í•œ ë°©ì‹
            SELECT dept_name
            FROM department
            WHERE dept_id IN (SELECT dept_id FROM employee);

            IN: ì§ì›ì´ ìžˆëŠ” ëª¨ë“  ë¶€ì„œ ID ë¦¬ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ë‹¤ ë§Œë“  ë‹¤ìŒ ë¹„êµí•©ë‹ˆë‹¤.
            EXISTS: ë¶€ì„œ í•˜ë‚˜í•˜ë‚˜ë§ˆë‹¤ ì§ì›ì´ ìžˆëŠ”ì§€ í™•ì¸í•˜ë©° ì§€ë‚˜ê°‘ë‹ˆë‹¤.
*/

SELECT dept_name
FROM department d
WHERE EXISTS( 
      SELECT 1
      FROM employee e
      WHERE e.dept_id = d.dept_id
);

SELECT DISTINCT d.dept_name
FROM department d
JOIN employee e ON d.dept_id = e.dept_id;


-- 6. ì‚¬ì›ì´ ì—†ëŠ” ë¶€ì„œë¥¼ ì¡°íšŒí•˜ì‹œì˜¤.
SELECT dept_name
FROM department d
WHERE NOT EXISTS (
    SELECT 1
    FROM employee e
    WHERE e.dept_id = d.dept_id
);
SELECT d.dept_name
FROM department d
LEFT JOIN employee e ON d.dept_id = e.dept_id
WHERE e.dept_id IS NULL;


-- 7. ê° ì‚¬ì›ì˜ ê¸‰ì—¬ì™€ ì „ì²´ í‰ê·  ê¸‰ì—¬ë¥¼ í•¨ê»˜ ì¡°íšŒí•˜ì‹œì˜¤.
/*
    SELECT ì ˆ ì•ˆì— ì„œë¸Œì¿¼ë¦¬ê°€ í†µì§¸ë¡œ ë“¤ì–´ê°”ì£ ? 
    ì´ê±¸ ì „ë¬¸ ìš©ì–´ë¡œ **'ìŠ¤ì¹¼ë¼ ì„œë¸Œì¿¼ë¦¬(Scalar Subquery)'**ë¼ê³  ë¶ˆëŸ¬ìš”.

    ì»´í“¨í„°ê°€ ì¼ì„ ì²˜ë¦¬í•˜ëŠ” ìˆœì„œë¥¼ ë”°ë¼ê°€ ë³¼ê²Œìš”.

        1.ë©”ì¸ ì¿¼ë¦¬ ì‹¤í–‰: employee í…Œì´ë¸”ì—ì„œ ì§ì› í•œ ëª…ì”© ì •ë³´ë¥¼ ê°€ì ¸ì˜µë‹ˆë‹¤.

        2.ì´ë¦„ê³¼ ê¸‰ì—¬ ì¶œë ¥: ë¨¼ì € emp_nameê³¼ salaryë¥¼ ë°”êµ¬ë‹ˆì— ë‹´ìŠµë‹ˆë‹¤.

        3.ê°‘ìžê¸° ì„œë¸Œì¿¼ë¦¬ ì‹¤í–‰: ì„¸ ë²ˆì§¸ ì»¬ëŸ¼ì„ ì±„ìš°ë ¤ëŠ”ë°, ê°‘ìžê¸° ê´„í˜¸( ) ì•ˆì— ìžˆëŠ” ì¿¼ë¦¬ê°€ ë‚˜íƒ€ë‚©ë‹ˆë‹¤. "ì–´? ì „ì²´ í‰ê·  ê¸‰ì—¬(AVG)ë¥¼ ê³„ì‚°í•´ì˜¤ë¼ê³ ?"

        4.ê³„ì‚° ê²°ê³¼ ë¶™ì´ê¸°: ì„œë¸Œì¿¼ë¦¬ê°€ ê³„ì‚°í•œ ê²°ê³¼ê°’(ì˜ˆ: 450ë§Œ ì›)ì„ ëª¨ë“  í–‰ì— ë˜‘ê°™ì´ ì˜†ì—ë‹¤ ê°–ë‹¤ ë¶™ì—¬ì¤ë‹ˆë‹¤.
*/
SELECT emp_name,
       salary,
       (SELECT AVG(salary) FROM employee) AS avg_salary
FROM employee;
-- 8. ë¶€ì„œë³„ í‰ê·  ê¸‰ì—¬ê°€ 4000 ì´ìƒì¸ ë¶€ì„œë¥¼ ì¡°íšŒí•˜ì‹œì˜¤.
/*
    Step 1. ì„œë¸Œì¿¼ë¦¬(ê´„í˜¸ ì•ˆ) ë¨¼ì € í•´ê²° (ê°€ìž¥ ì¤‘ìš”!)
            ì»´í“¨í„°ëŠ” ê°€ìž¥ ë¨¼ì € FROM ë’¤ì— ìžˆëŠ” ê´„í˜¸ ì†ìœ¼ë¡œ ë›°ì–´ë“¤ì–´ê°‘ë‹ˆë‹¤.

            í–‰ë™: employee í…Œì´ë¸”ì„ ê°€ì ¸ì™€ì„œ dept_idë³„ë¡œ ì¤„ì„ ì„¸ì›ë‹ˆë‹¤(GROUP BY).
            í–‰ë™: ê° ë¶€ì„œë³„ë¡œ ê¸‰ì—¬ í‰ê· (AVG)ì„ ê³„ì‚°í•©ë‹ˆë‹¤.
            ê²°ê³¼: ë©”ëª¨ë¦¬ ê³µê°„ì— ìž„ì‹œ ê²°ê³¼í‘œê°€ í•˜ë‚˜ ë§Œë“¤ì–´ì§‘ë‹ˆë‹¤.

    Step 2. ê°€ìƒ í…Œì´ë¸”ì— ë³„ëª… t ë¶™ì´ê¸°
            ë°©ê¸ˆ ë§Œë“  ë”°ëˆë”°ëˆí•œ ê²°ê³¼í‘œì— të¼ëŠ” ì´ë¦„í‘œë¥¼ íƒ ë¶™ìž…ë‹ˆë‹¤.

            ì´ì œë¶€í„° ì´ ì¿¼ë¦¬ ì•ˆì—ì„œ të¼ê³  ë¶€ë¥´ë©´, ë°©ê¸ˆ ë§Œë“  'ë¶€ì„œë³„ í‰ê· í‘œ'ë¥¼ ì˜ë¯¸í•˜ê²Œ ë©ë‹ˆë‹¤. 
            (ì´ë¦„ì´ ì—†ìœ¼ë©´ ë°”ê¹¥ì—ì„œ ë¶ˆëŸ¬ë‹¤ ì“¸ ìˆ˜ê°€ ì—†ìœ¼ë‹ˆê¹Œìš”!)

    Step 3. WHERE ì ˆë¡œ í•„í„°ë§í•˜ê¸°
            ì´ì œ ì´ë¦„í‘œê°€ ë¶™ì€ t í…Œì´ë¸”ì„ ë³´ë©´ì„œ ì¡°ê±´ì„ ë”°ì§‘ë‹ˆë‹¤.

            í–‰ë™: t í…Œì´ë¸”ì˜ avg_salary ì»¬ëŸ¼ì„ í•˜ë‚˜ì”© í™•ì¸í•©ë‹ˆë‹¤.
            í–‰ë™: ê°’ì´ 4000 ì´ìƒì¸ í–‰ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ëŠ” ê³¼ê°í•˜ê²Œ ë²„ë¦½ë‹ˆë‹¤.

    Step 4. SELECT ì ˆë¡œ ìµœì¢… ì¶œë ¥
            ë§ˆì§€ë§‰ìœ¼ë¡œ ì‚´ì•„ë‚¨ì€ ë°ì´í„°ë“¤ ì¤‘ì—ì„œ ìš°ë¦¬ ëˆˆì— ë³´ì—¬ì¤„ ì»¬ëŸ¼ì„ ì„ íƒí•©ë‹ˆë‹¤.

            ê²°ê³¼: ìµœì¢…ì ìœ¼ë¡œ ì¡°ê±´ì„ í†µê³¼í•œ ë¶€ì„œì˜ IDì™€ ê·¸ í‰ê· ê°’ë§Œ í™”ë©´ì— ì¶œë ¥ë©ë‹ˆë‹¤.

    ** ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  FROM ì ˆ ì„œë¸Œì¿¼ë¦¬ë¥¼ ì“°ëŠ” ì´ìœ ëŠ”?

            - ë³µìž¡í•œ ê³„ì‚° ê²°ê³¼ë¥¼ ë§ˆì¹˜ ì²˜ìŒë¶€í„° ìžˆì—ˆë˜ í…Œì´ë¸”ì²˜ëŸ¼ íŽ¸í•˜ê²Œ ì“°ê³  ì‹¶ì„ ë•Œ.
            - ë©”ì¸ ì¿¼ë¦¬ì—ì„œ **ê°€ê³µëœ ë°ì´í„°(avg_salary)**ë¥¼ ê°€ì§€ê³  
            ë˜ ë‹¤ë¥¸ ë³µìž¡í•œ ìž‘ì—…ì„ ì´ì–´ì„œ í•´ì•¼ í•  ë•Œ ìœ ìš©í•©ë‹ˆë‹¤.
*/
SELECT dept_id, avg_salary
FROM (
    SELECT dept_id, AVG(salary) AS avg_salary
    FROM employee
    GROUP BY dept_id
) t
WHERE avg_salary >= 4000;

/* ë¶€ì„œì´ë¦„ ê¹Œì§€ë„ ì¡°íšŒí•˜ê³  ì‹¶ì„ë•Œ*/
/*
    [ì½”ë“œ ì§„í–‰ ìˆœì„œ: ì´ë²ˆì—” ì¡°ê¸ˆ ë” ë³µìž¡í•´ìš”!]
        1.ê°€ìž¥ ë¨¼ì € (ì„œë¸Œì¿¼ë¦¬ ì‹¤í–‰):
            employee í…Œì´ë¸”ì„ ë’¤ì ¸ì„œ ë¶€ì„œë³„ í‰ê·  ê¸‰ì—¬í‘œ(t)ë¥¼ ë§Œë“­ë‹ˆë‹¤.
            ì´ë•Œ ê²°ê³¼ëŠ” {10: 4500, 20: 3500} ì´ëŸ° ì‹ì´ê² ì£ ?

        2.ê·¸ ë‹¤ìŒ (JOIN ì‹¤í–‰):
            ë°©ê¸ˆ ë§Œë“  ê°€ìƒ í…Œì´ë¸” tì™€ ì§„ì§œ í…Œì´ë¸” departmentë¥¼ dept_id ê¸°ì¤€ìœ¼ë¡œ í•©ì¹©ë‹ˆë‹¤.
            ì´ì œ ë“œë””ì–´ 'ì˜ì—…ë¶€ - 4500' ì²˜ëŸ¼ ì´ë¦„ê³¼ í‰ê· ì´ í•œ ì¤„ì— ëª¨ì´ê²Œ ë©ë‹ˆë‹¤.

        3.í•„í„°ë§ (WHERE ì‹¤í–‰):
            í•©ì³ì§„ ê²°ê³¼ ì¤‘ì—ì„œ avg_salaryê°€ 4000 ì´ìƒì¸ ì¤„ë§Œ ë‚¨ê¹ë‹ˆë‹¤.

        4.ìµœì¢… ì¶œë ¥ (SELECT):
            ìµœì¢…ì ìœ¼ë¡œ ë¶€ì„œ ì´ë¦„(dept_name)ê³¼ í‰ê·  ê¸‰ì—¬(avg_salary)ë¥¼ í™”ë©´ì— ë³´ì—¬ì¤ë‹ˆë‹¤.

        ðŸ’¡ ì™œ department í…Œì´ë¸”ì„ ì„œë¸Œì¿¼ë¦¬ ë°–ì—ì„œ ì“°ë‚˜ìš”?
            ë¬¼ë¡  ì„œë¸Œì¿¼ë¦¬ ì•ˆì—ì„œ ì²˜ìŒë¶€í„° ë‹¤ í•©ì¹  ìˆ˜ë„ ìžˆì§€ë§Œ, 
            ì•„ëž˜ì²˜ëŸ¼ ì§œëŠ” ê²ƒì´ ì‹¤ë¬´ì ìœ¼ë¡œ ë” ì¢‹ì€ ì´ìœ ê°€ ìžˆì–´ìš”.

            ì—­í•  ë¶„ë‹´: ì„œë¸Œì¿¼ë¦¬ëŠ” "ê³„ì‚°"ë§Œ ë‹´ë‹¹í•˜ê³ , 
            ë©”ì¸ ì¿¼ë¦¬ëŠ” "ì´ë¦„ ë¶™ì´ê¸°(JOIN)"ë§Œ ë‹´ë‹¹í•˜ê²Œ í•´ì„œ ì½”ë“œë¥¼ ì½ê¸° íŽ¸í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤.

            ì„±ëŠ¥: ë¨¼ì € í‰ê· ì„ ë‹¤ ê³„ì‚°í•´ì„œ ì¤„(Row) ìˆ˜ë¥¼ ì¤„ì—¬ë†“ì€ ë‹¤ìŒì— ì´ë¦„ì„ ë¶™ì´ëŠ”(JOIN) ê²Œ, 
                 ìˆ˜ë§Œ ëª…ì˜ ì§ì› ì´ë¦„ì„ í•˜ë‚˜í•˜ë‚˜ ë¶™ì¸ ë’¤ì— í‰ê· ì„ ë‚´ëŠ” ê²ƒë³´ë‹¤ í›¨ì”¬ ë¹ ë¥¼ ë•Œê°€ ë§ŽìŠµë‹ˆë‹¤

*/
SELECT d.dept_name, t.avg_salary
FROM department d
JOIN (
    -- 1ë‹¨ê³„: ë¶€ì„œë³„ í‰ê·  ê¸‰ì—¬ë¥¼ ë¨¼ì € êµ¬í•´ì„œ 't'ë¼ê³  ë¶€ë¦„
    SELECT dept_id, AVG(salary) AS avg_salary
    FROM employee
    GROUP BY dept_id
) t ON d.dept_id = t.dept_id
WHERE t.avg_salary >= 4000;
-- 9. ê° ë¶€ì„œì—ì„œ í‰ê·  ê¸‰ì—¬ë³´ë‹¤ ë§Žì´ ë°›ëŠ” ì‚¬ì›ì„ ì¡°íšŒí•˜ì‹œì˜¤.
/*
    ì»´í“¨í„°ëŠ” ì´ ì¿¼ë¦¬ë¥¼ ì²˜ë¦¬í•  ë•Œ ì§ì› í•œ ëª… í•œ ëª…ì„ ë¶™ìž¡ê³  ì§ˆë¬¸ì„ ë˜ì§‘ë‹ˆë‹¤.

        1.ë©”ì¸ ì¿¼ë¦¬ ì‹œìž‘: employee í…Œì´ë¸”ì—ì„œ ì²« ë²ˆì§¸ ì§ì›(ì˜ˆ: ì˜ì—…ë¶€ 'ê¹€ëŒ€ë¦¬')ì„ ì„ íƒí•©ë‹ˆë‹¤.

        2.ì„œë¸Œì¿¼ë¦¬ ë°°ë‹¬: ê¹€ëŒ€ë¦¬ì˜ dept_id(ì˜ì—…ë¶€)ë¥¼ ë“¤ê³  ê´„í˜¸ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°‘ë‹ˆë‹¤.

        3.ì„œë¸Œì¿¼ë¦¬ ê³„ì‚°: "ì˜ì—…ë¶€(e.dept_id) ì§ì›ë“¤ì˜ í‰ê·  ê¸‰ì—¬ë§Œ ê³„ì‚°í•´ë´!" (ì´ë•Œ ë‹¤ë¥¸ ë¶€ì„œ ì‚¬ëžŒë“¤ì€ ë¬´ì‹œí•©ë‹ˆë‹¤.)

        4.ë¹„êµ: "ê¹€ëŒ€ë¦¬ì˜ ì›”ê¸‰ì´ ë°©ê¸ˆ ê³„ì‚°í•œ ì˜ì—…ë¶€ í‰ê· ë³´ë‹¤ ë†’ì€ê°€?"

                ë†’ìœ¼ë©´? ê¹€ëŒ€ë¦¬ë¥¼ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì— ì˜¬ë¦½ë‹ˆë‹¤.
                ë‚®ìœ¼ë©´? íƒˆë½!

        5.ë°˜ë³µ: ë‹¤ìŒ ì§ì›(ì˜ˆ: ê°œë°œë¶€ 'ì´ê³¼ìž¥')ì„ ë¶™ìž¡ê³  2~4ë²ˆ ê³¼ì •ì„ ë°˜ë³µí•©ë‹ˆë‹¤.

        (ì¢€ë” ìžì„¸í•˜ê²Œ)

        ë°ì´í„°ê°€ ì´ë ‡ê²Œ ìžˆë‹¤ê³  ê°€ì •í•´ ë³¼ê²Œìš”.

            ì˜ì—…ë¶€(10): ê¹€ëŒ€ë¦¬(300), ë°•ê³¼ìž¥(500)
            ê°œë°œë¶€(20): ì´ì‚¬ì›(400), ìµœíŒ€ìž¥(600)

            1.ì»´í“¨í„°ê°€ ê¹€ëŒ€ë¦¬ë¥¼ ìž¡ìŠµë‹ˆë‹¤. (ì´ë•Œ e.dept_idëŠ” 10)

            2.ì„œë¸Œì¿¼ë¦¬ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤: SELECT AVG(salary) FROM employee WHERE dept_id = 10

                        ì˜ì—…ë¶€ ì‚¬ëžŒë“¤(300, 500)ë§Œ ëª¨ì•„ì„œ í‰ê·  400ì„ ëƒ…ë‹ˆë‹¤.

            3.ë¹„êµí•©ë‹ˆë‹¤: ê¹€ëŒ€ë¦¬(300) > ì˜ì—…ë¶€ í‰ê· (400)? â†’ ê±°ì§“! (íƒˆë½)

            4.ì»´í“¨í„°ê°€ ì´ì‚¬ì›ì„ ìž¡ìŠµë‹ˆë‹¤. (ì´ë•Œ e.dept_idëŠ” 20)

            5.ì„œë¸Œì¿¼ë¦¬ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤: SELECT AVG(salary) FROM employee WHERE dept_id = 20

                        ê°œë°œë¶€ ì‚¬ëžŒë“¤(400, 600)ë§Œ ëª¨ì•„ì„œ í‰ê·  500ì„ ëƒ…ë‹ˆë‹¤.

            6.ë¹„êµí•©ë‹ˆë‹¤: ì´ì‚¬ì›(400) > ê°œë°œë¶€ í‰ê· (500)? â†’ ê±°ì§“! (íƒˆë½)

            ** ì™œ e.ì„ í•œìª½ì—ë§Œ ë¶™ì˜€ë‚˜ìš”?
            ì•ˆìª½ ì„œë¸Œì¿¼ë¦¬ ìž…ìž¥ì—ì„œëŠ” ìžê¸° í…Œì´ë¸”ì˜ ì»¬ëŸ¼ì€ ê·¸ëƒ¥ dept_idë¼ê³ ë§Œ ì¨ë„ ì•Œì•„ë“£ìŠµë‹ˆë‹¤. 
            í•˜ì§€ë§Œ **"ë°”ê¹¥ìª½ì—ì„œ ê²€ì‚¬ë°›ìœ¼ëŸ¬ ì˜¨ ê·¸ ë…€ì„ì˜ ë¶€ì„œ"**ë¥¼ ì§€ì¹­í•˜ë ¤ë©´
            ë³„ëª…ì¸ e.ì„ ê¼­ ë¶™ì—¬ì¤˜ì•¼ ì»´í“¨í„°ê°€ í—·ê°ˆë¦¬ì§€ ì•Šì•„ìš”.

            ì •ë¦¬í•˜ìžë©´!
            e.dept_id: "ì§€ê¸ˆ ê²€ì‚¬ ì¤‘ì¸ ê·¸ ì‚¬ëžŒì˜ ë¶€ì„œ" (ë°”ê¹¥ìª½ ê³ ì •ê°’)
            dept_id: "í‰ê·  ê³„ì‚°ì— í¬í•¨í•  ì§ì›ë“¤ì˜ ë¶€ì„œ" (ì•ˆìª½ ë¹„êµ ëŒ€ìƒ)
            ê²°êµ­ ì´ ì‹ì€ **"ê°™ì€ ë¶€ì„œ ì‚¬ëžŒë“¤ë¼ë¦¬ë§Œ ë¬¶ì–´ë¼!"**ë¼ëŠ” í•„í„°ê°€ ë˜ëŠ” ê²ë‹ˆë‹¤.
*/
SELECT emp_name, salary
FROM employee e
WHERE salary > (
    SELECT AVG(salary)
    FROM employee
    WHERE dept_id = e.dept_id
);
-- 10. í‰ê·  ê¸‰ì—¬ë³´ë‹¤ ë†’ì€ ì‚¬ì›ì„ JOIN ë°©ì‹ìœ¼ë¡œë„ ì¡°íšŒí•˜ì‹œì˜¤.
/*
    **FROM ì ˆ ì„œë¸Œì¿¼ë¦¬(ì¸ë¼ì¸ ë·°)**ì™€ **JOIN**ì„ ì•„ì£¼ ì°½ì˜ì ìœ¼ë¡œ ê²°í•©í•œ í˜•íƒœìž…ë‹ˆë‹¤. 
    ë³´í†µ JOINì€ ID = IDì²˜ëŸ¼ ë˜‘ê°™ì€ ê°’ì„ ì°¾ì„ ë•Œ ì“°ëŠ”ë°, 
    ì´ë²ˆì—” **> (í¬ë‹¤)**ë¼ëŠ” ì¡°ê±´ì„ ê±¸ì—ˆê±°ë“ ìš”!

    Step 1: ì„œë¸Œì¿¼ë¦¬ ë³„ì¹­ a ê°€ ë¨¼ì € ê³„ì‚°ë©ë‹ˆë‹¤.

        SELECT AVG(salary) AS avg_salary FROM employee
        ì»´í“¨í„°ê°€ íšŒì‚¬ ì „ì²´ ì‚¬ì› ì›”ê¸‰ì„ ë‹¤ ë”í•´ì„œ í‰ê· ì„ ëƒ…ë‹ˆë‹¤.
        ê²°ê³¼ëŠ” ë”± **ìˆ«ìž í•˜ë‚˜(ì˜ˆ: 450)**ê°€ ë“  ìž‘ì€ í‘œê°€ ë©ë‹ˆë‹¤. ì´ í‘œì˜ ì´ë¦„ì€ ì´ì œ **a**ìž…ë‹ˆë‹¤.

    Step 2: JOIN ì¡°ê±´(ON)ì„ í™•ì¸í•©ë‹ˆë‹¤.
        ë³´í†µì€ e.dept_id = d.dept_id ì²˜ëŸ¼ ë˜‘ê°™ì€ ê±¸ ì°¾ì§€ë§Œ, 
        ì—¬ê¸°ì„  **e.salary > a.avg_salary**ë¥¼ ë´…ë‹ˆë‹¤.

        "ì§ì›(e)ì˜ ì›”ê¸‰ì´ í‰ê· (a.avg_salary)ë³´ë‹¤ í° ê²½ìš°ì—ë§Œ ë‘ í‘œë¥¼ í•©ì³ë¼!"ë¼ëŠ” ëœ»ìž…ë‹ˆë‹¤.

    Step 3: ìµœì¢… ê²°ê³¼ ì¶œë ¥
    í‰ê· ë³´ë‹¤ ë§Žì´ ë°›ëŠ” ì‚¬ëžŒë“¤ë§Œ ì‚´ì•„ë‚¨ì•„ ì´ë¦„ê³¼ ì›”ê¸‰ì´ ì¶œë ¥ë©ë‹ˆë‹¤.

    3. ì™œ ì´ë ‡ê²Œ ì§œë‚˜ìš”? (ìƒê´€ ì„œë¸Œì¿¼ë¦¬ì™€ì˜ ì°¨ì´)
            ì•„ê¹Œ ë³´ì‹  ìƒê´€ ì„œë¸Œì¿¼ë¦¬ì™€ ë¹„êµí•˜ë©´ ì´ ì¿¼ë¦¬ì˜ ìž¥ì ì´ ëª…í™•í•´ì§‘ë‹ˆë‹¤.

            ì†ë„ê°€ ë¹ ë¦…ë‹ˆë‹¤: ìƒê´€ ì„œë¸Œì¿¼ë¦¬ëŠ” ì§ì› 100ëª…ì´ë©´ í‰ê· ì„ 100ë²ˆ ë‚´ì§€ë§Œ, 
                ì´ ì¿¼ë¦¬ëŠ” í‰ê· ì„ ë”± í•œ ë²ˆë§Œ ë‚´ì„œ í‘œ(a)ë¥¼ ë§Œë“¤ì–´ë‘ê³  ì‹œìž‘í•©ë‹ˆë‹¤.

            ì „ì²´ ë¹„êµ vs ë¶€ì„œ ë‚´ ë¹„êµ:

            ì•„ê¹Œ ì¿¼ë¦¬(WHEREì ˆ ìƒê´€ ì„œë¸Œì¿¼ë¦¬): "ìš°ë¦¬ ë¶€ì„œ" í‰ê· ë³´ë‹¤ ìž˜ ë²„ëŠ”ê°€?

            ì´ë²ˆ ì¿¼ë¦¬(JOIN ë°©ì‹): "íšŒì‚¬ ì „ì²´" í‰ê· ë³´ë‹¤ ìž˜ ë²„ëŠ”ê°€?
*/
SELECT e.emp_name, e.salary
FROM employee e
JOIN (
    SELECT AVG(salary) AS avg_salary FROM employee
) a
ON e.salary > a.avg_salary;
